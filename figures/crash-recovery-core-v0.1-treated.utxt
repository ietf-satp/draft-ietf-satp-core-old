                    ┌──────────────┐          ┌──────────┐                                          ┌──────────┐                           ┌──────────────┐          
                    │State Data DB1│          │Gateway G1│                                          │Gateway G2│                           │State Data DB2│          
                    └──────────────┘          └──────────┘                                          └──────────┘                           └──────────────┘          
                           │                       │                𝟏 Lock-Assertion (2.2)               │                                        │                  
                           │                       │ ────────────────────────────────────────────────────>                                        │                  
                           │                       │                                                     │                                        │                  
                           │                       │────┐                                                │                                        │                  
                           │                       │    │ 𝟐 Crash                                        │                                        │                  
                           │                       │<───┘                                                │                                        │                  
                           │                       │                                                     │                                        │                  
                           │                       │                                                     │────┐                                                      
                           │                       │                                                     │    │ 𝟑 do Lock-Assertion Broadcast (2.3)                  
                           │                       │                                                     │<───┘                                                      
                           │                       │                                                     │                                        │                  
                           │                       │ 𝟒 Lock-Assertion-Receipt (2.4) Gets 503 or no answer│                                        │                  
                           │                       │ <────────────────────────────────────────────────────                                        │                  
                           │                       │                                                     │                                        │                  
                           │                       │                                                     │                                        │                  
                           │        ╔══════╤═══════╪═════════════════════════════════════════════════════╪════════════════════════════════════════╪═════════════════╗
                           │        ║ ALT  │  retry until application timeout                            │                                        │                 ║
                           │        ╟──────┘       │                                                     │                                        │                 ║
                           │        ║              │         𝟓 send Lock-Assertion-Receipt (2.4)         │                                        │                 ║
                           │        ║              │ <────────────────────────────────────────────────────                                        │                 ║
                           │        ╠══════════════╪═════════════════════════════════════════════════════╪════════════════════════════════════════╪═════════════════╣
                           │        ║ [Failure]    │                                                     │                                        │                 ║
                           │        ║              │                                                     │      𝟔 record G1 has crashed, wait     │                 ║
                           │        ║              │                                                     │ ───────────────────────────────────────>                 ║
                           │        ╚══════════════╪═════════════════════════════════════════════════════╪════════════════════════════════════════╪═════════════════╝
                           │                       │                                                     │                                        │                  
                           │                       │                                                     │                                        │                  
          ╔══════╤═════════╪═══════════════════════╪═════════════════════════════════════════════════════╪════════════════════════════════════════╪═════════════════╗
          ║ ALT  │  waiting until max_timeout      │                                                     │                                        │                 ║
          ╟──────┘         │                       │                                                     │                                        │                 ║
          ║                │                       │────┐                                                │                                        │                 ║
          ║                │                       │    │ 𝟕 recovers from crash                          │                                        │                 ║
          ║                │                       │<───┘                                                │                                        │                 ║
          ║                │                       │                                                     │                                        │                 ║
          ║                │                       │                      𝟖 RECOVER                      │                                        │                 ║
          ║                │                       │ ────────────────────────────────────────────────────>                                        │                 ║
          ║                │                       │                                                     │                                        │                 ║
          ║                │                       │                   𝟗 RECOVER-UPDATE                  │                                        │                 ║
          ║                │                       │ <────────────────────────────────────────────────────                                        │                 ║
          ║                │                       │                                                     │                                        │                 ║
          ║                │    𝟏𝟎 update state    │                                                     │                                        │                 ║
          ║                │ <──────────────────────                                                     │                                        │                 ║
          ║                │                       │                                                     │                                        │                 ║
          ║                │                       │                𝟏𝟏 RECOVER-UPDATE-ACK                │                                        │                 ║
          ║                │                       │ ────────────────────────────────────────────────────>                                        │                 ║
          ║                │                       │                                                     │                                        │                 ║
          ║                │                       │           𝟏𝟐 Lock-Assertion-Receipt (2.4)           │                                        │                 ║
          ║                │                       │ <────────────────────────────────────────────────────                                        │                 ║
          ╠════════════════╪═══════════════════════╪═════════════════════════════════════════════════════╪════════════════════════════════════════╪═════════════════╣
          ║ [Failure]      │                       │                                                     │                                        │                 ║
          ║                │                       │                                                     │   𝟏𝟑 record G1 has crashed definitely  │                 ║
          ║                │                       │                                                     │ ───────────────────────────────────────>                 ║
          ║                │                       │                                                     │                                        │                 ║
          ║                │                       │                                                     │────┐                                   │                 ║
          ║                │                       │                                                     │    │ 𝟏𝟒 Initiate rollback process      │                 ║
          ║                │                       │                                                     │<───┘                                   │                 ║
          ║                │                       │                                                     │                                        │                 ║
          ╚════════════════╪═══════════════════════╪═════════════════════════════════════════════════════╪════════════════════════════════════════╪═════════════════╝
                    ┌──────────────┐          ┌──────────┐                                          ┌──────────┐                           ┌──────────────┐          
                    │State Data DB1│          │Gateway G1│                                          │Gateway G2│                           │State Data DB2│          
                    └──────────────┘          └──────────┘                                          └──────────┘                           └──────────────┘          
